#import "RCTViewSnapshotter.h"

@implementation RCTViewSnapshotter

+ (instancetype)sharedInstance {
  static RCTViewSnapshotter *sharedViewSnapshotter = nil;
  @synchronized(self) {
    if (sharedViewSnapshotter == nil)
      sharedViewSnapshotter = [self new];
  }
  return sharedViewSnapshotter;
}

- (instancetype)init
{
  self = [super init];
  if (self) {
    self.viewSnapshots = [@[] mutableCopy];
  }
  return self;
}

- (void)snapshotView:(nonnull NSNumber *)reactTag
            viewName:(NSString *)viewName
             rootTag:(__unused NSNumber *)rootTag
               props:(NSDictionary *)props
{
  [self.viewSnapshots addObject:@{
                                  @"type": @"create",
                                  @"reactTag": reactTag,
                                  @"viewName": viewName,
                                  @"rootTag": rootTag,
                                  @"props": props ?: [NSNull null]
                                  }];
}

- (void)snapshotSetChildren:(nonnull NSNumber *)containerTag
                  reactTags:(NSArray<NSNumber *> *)reactTags
{
  [self.viewSnapshots addObject:@{
                                 @"type": @"setChildren",
                                 @"containerTag": containerTag,
                                 @"reactTags": reactTags
                                  }];
}

@end
